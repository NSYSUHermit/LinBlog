---
title: Web crawler on simple Chinese web
author: Hermit
date: '2019-05-02'
slug: web-crawler-on-simple-chinese-web
categories:
  - R
tags:
  - crawler
---



<p>We will use the R-package:“rvest” for web crawler this time.</p>
<p>The example web html: <a href="https://heavenlyfood.cn/books/menu.php?id=2021" class="uri">https://heavenlyfood.cn/books/menu.php?id=2021</a> (国度的操练为着教会的建造)<br />
This web is written by simple Chinese. So we will trans the language to Traditional Chinese.<br />
We will use the R-package:“ropencc” to do this job. You can download the “ropencc” on Github.
Then output the the chapters to each text files.</p>
<div id="link-the-website" class="section level1">
<h1>Link the website</h1>
<pre class="r"><code>if (!require(rvest))install.packages(&quot;rvest&quot;)</code></pre>
<pre><code>## Loading required package: rvest</code></pre>
<pre><code>## Loading required package: xml2</code></pre>
<pre class="r"><code>library(rvest)

if (!require(ropencc))devtools::install_github(&quot;qinwf/ropencc&quot;)</code></pre>
<pre><code>## Loading required package: ropencc</code></pre>
<pre><code>## Warning in library(package, lib.loc = lib.loc, character.only = TRUE,
## logical.return = TRUE, : there is no package called &#39;ropencc&#39;</code></pre>
<pre><code>## Downloading GitHub repo qinwf/ropencc@master</code></pre>
<pre><code>## 
##   
  
  
   checking for file &#39;C:\Users\User\AppData\Local\Temp\Rtmpak6Kb0\remotes33042f961524\qinwf-ropencc-a5deb1f/DESCRIPTION&#39; ...
  
   checking for file &#39;C:\Users\User\AppData\Local\Temp\Rtmpak6Kb0\remotes33042f961524\qinwf-ropencc-a5deb1f/DESCRIPTION&#39; ... 
  
√  checking for file &#39;C:\Users\User\AppData\Local\Temp\Rtmpak6Kb0\remotes33042f961524\qinwf-ropencc-a5deb1f/DESCRIPTION&#39;
## 
  
  
  
-  preparing &#39;ropencc&#39;:
##    checking DESCRIPTION meta-information ...
  
   checking DESCRIPTION meta-information ... 
  
√  checking DESCRIPTION meta-information
## -  cleaning src
## 
  
  
  
-  checking for LF line-endings in source and make files and shell scripts
## 
  
  
  
-  checking for empty or unneeded directories
## 
  
  
  
-  building &#39;ropencc_0.1.tar.gz&#39;
## 
  
   
## </code></pre>
<pre><code>## Installing package into &#39;C:/Users/User/Documents/R/win-library/3.5&#39;
## (as &#39;lib&#39; is unspecified)</code></pre>
<pre class="r"><code>library(ropencc)

#read the html
bible &lt;- read_html(&quot;https://heavenlyfood.cn/books/menu.php?id=2021&quot;)

#get the title
bible_title &lt;- html_nodes(bible,&quot;#title&quot;)
title &lt;- html_text(bible_title)
title &lt;- title[2:9]
trans &lt;- converter(S2TWP)
title &lt;- run_convert(trans, title) #trans simple chinese to traditional chinese

#get the chapter&#39;s url
url &lt;- html_nodes(bible,&quot;div a&quot;)  
url &lt;- data.frame(html_attr(url,&quot;href&quot;))
url &lt;- t(data.frame(url[80:87,1])) #transpose the url data</code></pre>
</div>
<div id="content-grabbing" class="section level1">
<h1>Content Grabbing</h1>
<p>We want to save one chapter in one txt file. So I save one time after I collect one chapter.</p>
<pre class="r"><code>for(i in c(1:length(title))){
  
  #link to the chapter url
  chapter_url &lt;- paste0(&quot;https://heavenlyfood.cn/&quot;, url[i])
  bible1 &lt;- read_html(chapter_url)
  
  #grab the content
  bible_cont &lt;- html_nodes(bible1,&quot;.cont&quot;)
  cont &lt;- html_text(bible_cont,trim = TRUE)
  
  #trans simple Chinese to traditional Chinese
  cont[1] &lt;- title[i] #name the title
  cont &lt;- run_convert(trans, cont)
  
  #output the txt for each chapter
  nam &lt;- paste(title[i],&quot;.txt&quot;, sep=&quot; &quot;)
  write.table(cont,nam)
}</code></pre>
<p>We will get eight text files after the code run.<br />
The result:</p>
</div>
